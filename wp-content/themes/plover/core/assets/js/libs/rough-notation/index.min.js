(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function s(){return Math.floor(Math.random()*2**31)}t.r(e),t.d(e,{Highlight:()=>R,Render:()=>i,RoughNotation:()=>P,Style:()=>S,Underline:()=>x,annotate:()=>C,randomSeed:()=>s});class n{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const o="http://www.w3.org/2000/svg";class i{_styles={};constructor(t={}){this._styles=t}registerStyle(t,e){this._styles[t]=e}render(t,e,s,n,i,a){if(!this._styles[s.type])return;const r={config:s,rect:e,seed:a,strokeWidth:s.strokeWidth||2,padding:this._parsePadding(s),animate:void 0===s.animate||!!s.animate,iterations:s.iterations||2,rtl:s.rtl?1:0,getRoughOptions:this._getOptions,singleRoughOptions:this._getOptions("single",a)},h=this._styles[s.type].draw(r);if(h.length){const e=this._opsToPath(h),a=[],c=[];let u=0;const d=(t,e,s)=>t.setAttribute(e,s);for(const n of e){const e=document.createElementNS(o,"path");if(d(e,"d",n),d(e,"fill","none"),d(e,"stroke",s.color||"currentColor"),d(e,"stroke-width",`${r.strokeWidth}`),r.animate){const t=e.getTotalLength();a.push(t),u+=t}t.appendChild(e),c.push(e)}if(r.animate){let t=0;for(let e=0;e<c.length;e++){const s=c[e],o=a[e],r=u?i*(o/u):0,h=n+t,d=s.style;d.strokeDashoffset=`${o}`,d.strokeDasharray=`${o}`,d.animation=`plover-rough-notation-dash ${r}ms ease-out ${h}ms forwards`,t+=r}}}}_parsePadding(t){const e=t.padding;if(e||0===e){if("number"==typeof e)return[e,e,e,e];if(Array.isArray(e)){const t=e;if(t.length)switch(t.length){case 4:return[...t];case 1:return[t[0],t[0],t[0],t[0]];case 2:return[...t,...t];case 3:return[...t,t[1]];default:return[t[0],t[1],t[2],t[3]]}}}return[5,5,5,5]}_getOptions(t,e){return{maxRandomnessOffset:2,roughness:"highlight"===t?3:1.5,bowing:1,stroke:"#000",strokeWidth:1.5,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,combineNestedSvgPaths:!1,disableMultiStroke:"double"!==t,disableMultiStrokeFill:!1,seed:e}}_opsToPath(t){const e=[];for(const s of t){let t="";for(const n of s.ops){const s=n.data;switch(n.op){case"move":t.trim()&&e.push(t.trim()),t=`M${s[0]} ${s[1]} `;break;case"bcurveTo":t+=`C${s[0]} ${s[1]}, ${s[2]} ${s[3]}, ${s[4]} ${s[5]} `;break;case"lineTo":t+=`L${s[0]} ${s[1]} `}}t.trim()&&e.push(t.trim())}return e}}const a={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function r(t,e){return t.type===e}function h(t){const e=[],s=function(t){const e=new Array;for(;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:0,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];e[e.length]={type:1,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length)}return e[e.length]={type:2,text:""},e}(t);let n="BOD",o=0,i=s[o];for(;!r(i,2);){let c=0;const u=[];if("BOD"===n){if("M"!==i.text&&"m"!==i.text)return h("M0,0"+t);o++,c=a[i.text],n=i.text}else r(i,1)?c=a[n]:(o++,c=a[i.text],n=i.text);if(!(o+c<s.length))throw new Error("Path data ended short");for(let t=o;t<o+c;t++){const e=s[t];if(!r(e,1))throw new Error("Param not a number: "+n+","+e.text);u[u.length]=+e.text}if("number"!=typeof a[n])throw new Error("Bad segment: "+n);{const t={key:n,data:u};e.push(t),o+=c,i=s[o],"M"===n&&(n="L"),"m"===n&&(n="l")}}return e}function c(t,e,s){return[t*Math.cos(s)-e*Math.sin(s),t*Math.sin(s)+e*Math.cos(s)]}function u(t,e,s,n,o,i,a,r,h,d){const l=(p=a,Math.PI*p/180);var p;let g=[],f=0,_=0,m=0,w=0;if(d)[f,_,m,w]=d;else{[t,e]=c(t,e,-l),[s,n]=c(s,n,-l);const a=(t-s)/2,u=(e-n)/2;let d=a*a/(o*o)+u*u/(i*i);d>1&&(d=Math.sqrt(d),o*=d,i*=d);const p=o*o,g=i*i,y=p*g-p*u*u-g*a*a,v=p*u*u+g*a*a,k=(r===h?-1:1)*Math.sqrt(Math.abs(y/v));m=k*o*u/i+(t+s)/2,w=k*-i*a/o+(e+n)/2,f=Math.asin(parseFloat(((e-w)/i).toFixed(9))),_=Math.asin(parseFloat(((n-w)/i).toFixed(9))),t<m&&(f=Math.PI-f),s<m&&(_=Math.PI-_),f<0&&(f=2*Math.PI+f),_<0&&(_=2*Math.PI+_),h&&f>_&&(f-=2*Math.PI),!h&&_>f&&(_-=2*Math.PI)}let y=_-f;if(Math.abs(y)>120*Math.PI/180){const t=_,e=s,r=n;_=h&&_>f?f+120*Math.PI/180*1:f+120*Math.PI/180*-1,g=u(s=m+o*Math.cos(_),n=w+i*Math.sin(_),e,r,o,i,a,0,h,[_,t,m,w])}y=_-f;const v=Math.cos(f),k=Math.sin(f),b=Math.cos(_),M=Math.sin(_),S=Math.tan(y/4),x=4/3*o*S,R=4/3*i*S,P=[t,e],C=[t+x*k,e-R*v],O=[s+x*M,n-R*b],L=[s,n];if(C[0]=2*P[0]-C[0],C[1]=2*P[1]-C[1],d)return[C,O,L].concat(g);{g=[C,O,L].concat(g);const t=[];for(let e=0;e<g.length;e+=3){const s=c(g[e][0],g[e][1],l),n=c(g[e+1][0],g[e+1][1],l),o=c(g[e+2][0],g[e+2][1],l);t.push([s[0],s[1],n[0],n[1],o[0],o[1]])}return t}}function d(t,e,s,n,o){return{type:"path",ops:m(t,e,s,n,o)}}function l(t,e,s){const n=(t||[]).length;if(n>2){const o=[];for(let e=0;e<n-1;e++)o.push(...m(t[e][0],t[e][1],t[e+1][0],t[e+1][1],s));return e&&o.push(...m(t[n-1][0],t[n-1][1],t[0][0],t[0][1],s)),{type:"path",ops:o}}return 2===n?d(t[0][0],t[0][1],t[1][0],t[1][1],s):{type:"path",ops:[]}}function p(t,e){const s=function(t){const e=[];let s="",n=0,o=0,i=0,a=0,r=0,h=0;for(const{key:c,data:d}of t){switch(c){case"M":e.push({key:"M",data:[...d]}),[n,o]=d,[i,a]=d;break;case"C":e.push({key:"C",data:[...d]}),n=d[4],o=d[5],r=d[2],h=d[3];break;case"L":e.push({key:"L",data:[...d]}),[n,o]=d;break;case"H":n=d[0],e.push({key:"L",data:[n,o]});break;case"V":o=d[0],e.push({key:"L",data:[n,o]});break;case"S":{let t=0,i=0;"C"===s||"S"===s?(t=n+(n-r),i=o+(o-h)):(t=n,i=o),e.push({key:"C",data:[t,i,...d]}),r=d[0],h=d[1],n=d[2],o=d[3];break}case"T":{const[t,i]=d;let a=0,c=0;"Q"===s||"T"===s?(a=n+(n-r),c=o+(o-h)):(a=n,c=o);const u=n+2*(a-n)/3,l=o+2*(c-o)/3,p=t+2*(a-t)/3,g=i+2*(c-i)/3;e.push({key:"C",data:[u,l,p,g,t,i]}),r=a,h=c,n=t,o=i;break}case"Q":{const[t,s,i,a]=d,c=n+2*(t-n)/3,u=o+2*(s-o)/3,l=i+2*(t-i)/3,p=a+2*(s-a)/3;e.push({key:"C",data:[c,u,l,p,i,a]}),r=t,h=s,n=i,o=a;break}case"A":{const t=Math.abs(d[0]),s=Math.abs(d[1]),i=d[2],a=d[3],r=d[4],h=d[5],c=d[6];0===t||0===s?(e.push({key:"C",data:[n,o,h,c,h,c]}),n=h,o=c):n===h&&o===c||(u(n,o,h,c,t,s,i,a,r).forEach((function(t){e.push({key:"C",data:t})})),n=h,o=c);break}case"Z":e.push({key:"Z",data:[]}),n=i,o=a}s=c}return e}(function(t){let e=0,s=0,n=0,o=0;const i=[];for(const{key:a,data:r}of t)switch(a){case"M":i.push({key:"M",data:[...r]}),[e,s]=r,[n,o]=r;break;case"m":e+=r[0],s+=r[1],i.push({key:"M",data:[e,s]}),n=e,o=s;break;case"L":i.push({key:"L",data:[...r]}),[e,s]=r;break;case"l":e+=r[0],s+=r[1],i.push({key:"L",data:[e,s]});break;case"C":i.push({key:"C",data:[...r]}),e=r[4],s=r[5];break;case"c":{const t=r.map(((t,n)=>n%2?t+s:t+e));i.push({key:"C",data:t}),e=t[4],s=t[5];break}case"Q":i.push({key:"Q",data:[...r]}),e=r[2],s=r[3];break;case"q":{const t=r.map(((t,n)=>n%2?t+s:t+e));i.push({key:"Q",data:t}),e=t[2],s=t[3];break}case"A":i.push({key:"A",data:[...r]}),e=r[5],s=r[6];break;case"a":e+=r[5],s+=r[6],i.push({key:"A",data:[r[0],r[1],r[2],r[3],r[4],e,s]});break;case"H":i.push({key:"H",data:[...r]}),e=r[0];break;case"h":e+=r[0],i.push({key:"H",data:[e]});break;case"V":i.push({key:"V",data:[...r]}),s=r[0];break;case"v":s+=r[0],i.push({key:"V",data:[s]});break;case"S":i.push({key:"S",data:[...r]}),e=r[2],s=r[3];break;case"s":{const t=r.map(((t,n)=>n%2?t+s:t+e));i.push({key:"S",data:t}),e=t[2],s=t[3];break}case"T":i.push({key:"T",data:[...r]}),e=r[0],s=r[1];break;case"t":e+=r[0],s+=r[1],i.push({key:"T",data:[e,s]});break;case"Z":case"z":i.push({key:"Z",data:[]}),e=n,s=o}return i}(h(t))),n=[];let o=[0,0],i=[0,0];for(const{key:t,data:a}of s)switch(t){case"M":{const t=1*(e.maxRandomnessOffset||0);n.push({op:"move",data:a.map((s=>s+_(t,e)))}),i=[a[0],a[1]],o=[a[0],a[1]];break}case"L":n.push(...m(i[0],i[1],a[0],a[1],e)),i=[a[0],a[1]];break;case"C":{const[t,s,o,r,h,c]=a;n.push(...b(t,s,o,r,h,c,i,e)),i=[h,c];break}case"Z":n.push(...m(i[0],i[1],o[0],o[1],e)),i=[o[0],o[1]]}return{type:"path",ops:n}}function g(t){return t.randomizer||(t.randomizer=new n(t.seed||0)),t.randomizer.next()}function f(t,e,s,n=1){return s.roughness*n*(g(s)*(e-t)+t)}function _(t,e,s=1){return f(-t,t,e,s)}function m(t,e,s,n,o,i=!1){const a=i?o.disableMultiStrokeFill:o.disableMultiStroke,r=w(t,e,s,n,o,!0,!1);if(a)return r;const h=w(t,e,s,n,o,!0,!0);return r.concat(h)}function w(t,e,s,n,o,i,a){const r=Math.pow(t-s,2)+Math.pow(e-n,2),h=Math.sqrt(r);let c=1;c=h<200?1:h>500?.4:-.0016668*h+1.233334;let u=o.maxRandomnessOffset||0;u*u*100>r&&(u=h/10);const d=u/2,l=.2+.2*g(o);let p=o.bowing*o.maxRandomnessOffset*(n-e)/200,f=o.bowing*o.maxRandomnessOffset*(t-s)/200;p=_(p,o,c),f=_(f,o,c);const m=[],w=()=>_(d,o,c),y=()=>_(u,o,c);return i&&(a?m.push({op:"move",data:[t+w(),e+w()]}):m.push({op:"move",data:[t+_(u,o,c),e+_(u,o,c)]})),a?m.push({op:"bcurveTo",data:[p+t+(s-t)*l+w(),f+e+(n-e)*l+w(),p+t+2*(s-t)*l+w(),f+e+2*(n-e)*l+w(),s+w(),n+w()]}):m.push({op:"bcurveTo",data:[p+t+(s-t)*l+y(),f+e+(n-e)*l+y(),p+t+2*(s-t)*l+y(),f+e+2*(n-e)*l+y(),s+y(),n+y()]}),m}function y(t,e,s){const n=[];n.push([t[0][0]+_(e,s),t[0][1]+_(e,s)]),n.push([t[0][0]+_(e,s),t[0][1]+_(e,s)]);for(let o=1;o<t.length;o++)n.push([t[o][0]+_(e,s),t[o][1]+_(e,s)]),o===t.length-1&&n.push([t[o][0]+_(e,s),t[o][1]+_(e,s)]);return v(n,null,s)}function v(t,e,s){const n=t.length,o=[];if(n>3){const i=[],a=1-s.curveTightness;o.push({op:"move",data:[t[1][0],t[1][1]]});for(let e=1;e+2<n;e++){const s=t[e];i[0]=[s[0],s[1]],i[1]=[s[0]+(a*t[e+1][0]-a*t[e-1][0])/6,s[1]+(a*t[e+1][1]-a*t[e-1][1])/6],i[2]=[t[e+1][0]+(a*t[e][0]-a*t[e+2][0])/6,t[e+1][1]+(a*t[e][1]-a*t[e+2][1])/6],i[3]=[t[e+1][0],t[e+1][1]],o.push({op:"bcurveTo",data:[i[1][0],i[1][1],i[2][0],i[2][1],i[3][0],i[3][1]]})}if(e&&2===e.length){const t=s.maxRandomnessOffset;o.push({op:"lineTo",data:[e[0]+_(t,s),e[1]+_(t,s)]})}}else 3===n?(o.push({op:"move",data:[t[1][0],t[1][1]]}),o.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===n&&o.push(...m(t[0][0],t[0][1],t[1][0],t[1][1],s));return o}function k(t,e,s,n,o,i,a,r){const h=[],c=[],u=_(.5,r)-Math.PI/2;c.push([_(i,r)+e+.9*n*Math.cos(u-t),_(i,r)+s+.9*o*Math.sin(u-t)]);for(let a=u;a<2*Math.PI+u-.01;a+=t){const t=[_(i,r)+e+n*Math.cos(a),_(i,r)+s+o*Math.sin(a)];h.push(t),c.push(t)}return c.push([_(i,r)+e+n*Math.cos(u+2*Math.PI+.5*a),_(i,r)+s+o*Math.sin(u+2*Math.PI+.5*a)]),c.push([_(i,r)+e+.98*n*Math.cos(u+a),_(i,r)+s+.98*o*Math.sin(u+a)]),c.push([_(i,r)+e+.9*n*Math.cos(u+.5*a),_(i,r)+s+.9*o*Math.sin(u+.5*a)]),[c,h]}function b(t,e,s,n,o,i,a,r){const h=[],c=[r.maxRandomnessOffset||1,(r.maxRandomnessOffset||1)+.3];let u=[0,0];const d=r.disableMultiStroke?1:2;for(let l=0;l<d;l++)0===l?h.push({op:"move",data:[a[0],a[1]]}):h.push({op:"move",data:[a[0]+_(c[0],r),a[1]+_(c[0],r)]}),u=[o+_(c[l],r),i+_(c[l],r)],h.push({op:"bcurveTo",data:[t+_(c[l],r),e+_(c[l],r),s+_(c[l],r),n+_(c[l],r),u[0],u[1]]});return h}function M(){}M.prototype.drawLine=function(...t){return d(...t)},M.prototype.drawEllipse=function(...t){return function(t,e,s,n,o){const i=function(t,e,s){const n=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),o=Math.max(s.curveStepCount,s.curveStepCount/Math.sqrt(200)*n),i=2*Math.PI/o;let a=Math.abs(t/2),r=Math.abs(e/2);const h=1-s.curveFitting;return a+=_(a*h,s),r+=_(r*h,s),{increment:i,rx:a,ry:r}}(s,n,o);return function(t,e,s,n){const[o,i]=k(n.increment,t,e,n.rx,n.ry,1,n.increment*f(.1,f(.4,1,s),s),s);let a=v(o,null,s);if(!s.disableMultiStroke){const[o]=k(n.increment,t,e,n.rx,n.ry,1.5,0,s),i=v(o,null,s);a=a.concat(i)}return{estimatedPoints:i,opset:{type:"path",ops:a}}}(t,e,o,i).opset}(...t)},M.prototype.drawLinearPath=function(...t){return l(...t)},M.prototype.drawRectangle=function(...t){return function(t,e,s,n,o){return function(t,e){return l(t,!0,e)}([[t,e],[t+s,e],[t+s,e+n],[t,e+n]],o)}(...t)},M.prototype.drawCurve=function(...t){return function(t,e){let s=y(t,1*(1+.2*e.roughness),e);if(!e.disableMultiStroke){const n=y(t,1.5*(1+.22*e.roughness),function(t){const e=Object.assign({},t);return e.randomizer=void 0,t.seed&&(e.seed=t.seed+1),e}(e));s=s.concat(n)}return{type:"path",ops:s}}(...t)},M.prototype.drawSvgPath=function(...t){return p(...t)};const S=M;class x extends S{draw(t){const{rect:e,padding:s,iterations:n,rtl:o,singleRoughOptions:i}=t,a=[],r=e.y+e.h+s[2];for(let t=o;t<n+o;t++)t%2?a.push(this.drawLine(e.x+e.w,r,e.x,r,i)):a.push(this.drawLine(e.x,r,e.x+e.w,r,i));return a}}class R extends S{draw(t){const{rect:e,rtl:s,iterations:n,seed:o,getRoughOptions:i}=t,a=[],r=i("highlight",o);t.strokeWidth=.95*e.h;const h=e.y+e.h/2;for(let t=s;t<n+s;t++)t%2?a.push(this.drawLine(e.x+e.w,h,e.x,h,r)):a.push(this.drawLine(e.x,h,e.x+e.w,h,r));return a}}class P{_state="unattached";_resizing=!1;_seed=s();_lastSizes=[];_animationDelay=0;constructor(t,e,s=null){this._e=t,this._config=e,this._attach(),this._renderImpl=s||new i({underline:new x,highlight:new R}),e.seed&&(this._seed=e.seed)}get animate(){return this._config.animate}set animate(t){this._config.animate=t}get animationDuration(){return this._config.animationDuration}set animationDuration(t){this._config.animationDuration=t}get iterations(){return this._config.iterations}set iterations(t){this._config.iterations=t}get color(){return this._config.color}set color(t){this._config.color!==t&&(this._config.color=t,this._refresh())}get strokeWidth(){return this._config.strokeWidth}set strokeWidth(t){this._config.strokeWidth!==t&&(this._config.strokeWidth=t,this._refresh())}get padding(){return this._config.padding}set padding(t){this._config.padding!==t&&(this._config.padding=t,this._refresh())}isShowing(){return"not-showing"!==this._state}show(){switch(this._state){case"unattached":break;case"showing":this.hide(),this._svg&&this._render(this._svg,!0);break;case"not-showing":this._attach(),this._svg&&this._render(this._svg,!1)}}hide(){if(this._svg)for(;this._svg.lastChild;)this._svg.removeChild(this._svg.lastChild);this._state="not-showing"}remove(){this._svg&&this._svg.parentElement&&this._svg.parentElement.removeChild(this._svg),this._svg=void 0,this._state="unattached",this._detachListeners()}_render(t,e){let s=this._config;e&&(s=JSON.parse(JSON.stringify(this._config)),s.animate=!1);const n=this._rects();let o=0;n.forEach((t=>o+=t.w));const i=s.animationDuration||800;let a=0;for(let e=0;e<n.length;e++){const r=i*(n[e].w/o);this._renderImpl.render(t,n[e],s,a+this._animationDelay,r,this._seed),a+=r}this._lastSizes=n,this._state="showing"}_attach(){var t;if("unattached"!==this._state||!this._e.parentElement)return;!function(){if(!window?.__rno_kf_s){const t=window.__rno_kf_s=document.createElement("style");t.textContent="@keyframes plover-rough-notation-dash { to { stroke-dashoffset: 0; } }",document.head.appendChild(t)}}();const e=this._svg=document.createElementNS(o,"svg");e.setAttribute("class","plover-rough-annotation-svg");const s=e.style;s.position="absolute",s.top="0",s.left="0",s.overflow="visible",s.pointerEvents="none",s.width="100px",s.height="100px";const n="highlight"===this._config.type;if((null!==(t=this._config?.wrapper)&&void 0!==t?t:this._e).insertAdjacentElement(n?"beforebegin":"afterend",e),this._state="not-showing",n){const t=window.getComputedStyle(this._e).position;(!t||"static"===t)&&(this._e.style.position="relative")}this._attachListeners()}_refresh(){this.isShowing()&&!this._pendingRefresh&&(this._pendingRefresh=Promise.resolve().then((()=>{this.isShowing()&&this.show(),delete this._pendingRefresh})))}_resizeListener=()=>{this._resizing||(this._resizing=!0,setTimeout((()=>{this._resizing=!1,"showing"===this._state&&this._haveRectsChanged()&&this.show()}),400))};_detachListeners(){window.removeEventListener("resize",this._resizeListener),this._ro&&this._ro.unobserve(this._e)}_attachListeners(){this._detachListeners(),window.addEventListener("resize",this._resizeListener,{passive:!0}),!this._ro&&"ResizeObserver"in window&&(this._ro=new window.ResizeObserver((t=>{for(const e of t)e.contentRect&&this._resizeListener()}))),this._ro&&this._ro.observe(this._e)}_haveRectsChanged(){if(this._lastSizes.length){const t=this._rects();if(t.length!==this._lastSizes.length)return!0;for(let e=0;e<t.length;e++)if(!this._isSameRect(t[e],this._lastSizes[e]))return!0}return!1}_isSameRect(t,e){const s=(t,e)=>Math.round(t)===Math.round(e);return s(t.x,e.x)&&s(t.y,e.y)&&s(t.w,e.w)&&s(t.h,e.h)}_rects(){const t=[];if(this._svg)if(this._config.multiline){const e=this._e.getClientRects();for(let s=0;s<e.length;s++)t.push(this._svgRect(this._svg,e[s]))}else t.push(this._svgRect(this._svg,this._e.getBoundingClientRect()));return t}_svgRect(t,e){const s=t.getBoundingClientRect(),n=e;return{x:(n.x||n.left)-(s.x||s.left),y:(n.y||n.top)-(s.y||s.top),w:n.width,h:n.height}}}function C(t,e={},s=null,n=t=>t){const o=Object.assign({style:"none",color:"currentColor",multiline:!0,animationDuration:"800",animation:!1,iterations:2,brackets:["left","right"]},n(JSON.parse(t.dataset.notationOptions)),e);return new P(t,{type:o.style,animate:o.animation,animationDuration:Number(o.animationDuration),...o},s)}class O{#t=[];add(t,e){const s=C(t,e,window?.PloverRoughNotation?._render,window?.PloverRoughNotation?._sanitizer.bind(window?.PloverRoughNotation));return this.#t.push(s),s}show(){const t=[...this.#t];for(const e of t)e.show()}hide(){const t=[...this.#t];for(const e of t)e.hide()}remove(){const t=[...this.#t];for(const e of t)e.remove();this.#t=[]}}window.PloverRoughNotation={Style:S,_render:new i,_options:["style","color","multiline"],_annotations:[],annotate:function(t,e={}){return t.dataset?.ploverRnId&&this._annotations[t.dataset?.ploverRnId]?this._annotations[t.dataset?.ploverRnId]:(t.dataset.ploverRnId=Date.now().toString(36)+Math.random().toString(36).substring(2,5),this._annotations[t.dataset.ploverRnId]=C(t,e,this._render,this._sanitizer.bind(this)),this._annotations[t.dataset.ploverRnId])},_sanitizer(t){for(const e in t)this._options.includes(e)||delete t[e];return t},allow(t){Array.isArray(t)?this._options=[...this._options,...t]:this._options.push(t)},registerStyle(t,e){this._render.registerStyle(t,e)}},window.PloverRoughNotationGroup={_groups:{},get:function(t){return this._groups[t]||(this._groups[t]=new O),this._groups[t]}},window.PloverRoughNotation.registerStyle("underline",new x),window.PloverRoughNotation.registerStyle("highlight",new R),(window.plover=window.plover||{})["rough-notation"]=e})();